<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>JS Patterns: Flyweight Pattern</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="../../main.css" />
</head>
<body class="container">
    <h1 class="title">Flyweight Pattern</h1>
    <ul class="navigation">
        <li class="nav_item"><a href="/index.html"><span class="label">Home</span></a></li>
        <li class="nav_item"><a href="/chapters/structural/structural.html"><span class="label">Structural Patterns</span></a></li>
    </ul>
    <h4 class="subtitle">Open the Dev tools!</h4>
    <script type="text/javascript">
        //Flyweight
        class Flyweight {
            constructor(make, model) {
                this.make = make;
                this.model = model;
            }
            getInfo() {
                return `My maker is ${this.make} and my model is ${this.model}`;
            }
        }
        const FlyweightFactory = (() => {
            const flyweights = {};
            const get = (make, model) => {
                if (!flyweights[make + model]) {
                    flyweights[make + model] = 
                        new Flyweight(make, model);
                }
                return flyweights[make + model];
            };
            const count = () => {
                return Object.keys(flyweights).length;
            };
            return {
                getFlyweight: get,
                getCount: count
            };
        })();

        class MemoryEnhancement {
            constructor(make, model, capacity, tag, serial) {
                this.flyweight = FlyweightFactory.getFlyweight(make, model);
                this.capacity = capacity;
                this.tag = tag;
                this.serial = serial;
            }

            get model() {
                return this.flyweight.model;
            }
            get make() {
                return this.flyweight.make;
            }
            get info() {
                return this.flyweight.getInfo();
            }
            set model(value) {
                throw new Error('Cannot override model property', value);
            }
            set make(value) {
                throw new Error('Cannot override make property', value);
            }
        }
        const MemoryShowcase = (() => {
            let count = 0;
            const availableEnhancements = {};
            const add = (make, model, capacity, tag, serial) => {
                availableEnhancements[serial] = new MemoryEnhancement(make, model, capacity, tag, serial);
                count += 1;
                console.log('Received a new enhancement for the store:', availableEnhancements[serial]);
            };
            const get = (serial) => {
                return availableEnhancements[serial];
            };
            const getCount = () => {
                return count;
            }
            return {
                addEnhancement: add,
                getEnhancement: get,
                getCount
            };
        })();
        
        console.groupCollapsed('A Memory Enhancements Virtual Store:');
        MemoryShowcase.addEnhancement('Mitsubishi', 'WiseX1', 4096, 'The Wise Sage', 'sr01');
        MemoryShowcase.addEnhancement('Mitsubishi', 'WiseX1', 2048, 'The Wise Guy', 'sr02');
        MemoryShowcase.addEnhancement('Nikon', 'SG01', 8192, 'The Sage', 'sr03');
        MemoryShowcase.addEnhancement('Nikon', 'SG01', 4096, 'Alexandria', 'sr04');
        MemoryShowcase.addEnhancement('Nikon', 'SG01', 2048, 'Alexandria', 'sr05');
        MemoryShowcase.addEnhancement('Nikon', 'SG01', 1024, 'Alexandria', 'sr06');
        console.log('Available Units in the Store:', MemoryShowcase.getCount());
        console.log('Number of Flyweights:', FlyweightFactory.getCount());
        console.groupEnd();
    </script>
</body>
</html>